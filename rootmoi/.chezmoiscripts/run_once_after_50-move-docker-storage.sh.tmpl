#!/bin/bash
# {{ template "scripts-library" }}
log_task "Rootmoi: 50. Moving docker image storage"

# daemon.json hash: {{ include "/etc/docker/daemon.json" | sha256sum }}
DOCKER_IMAGE_DIR=${DOCKER_IMAGE_DIR:-"{{ .dataspace.docker_image_dir }}"}

log_task "Stop Docker daemon"
c systemctl stop docker

log_task "Back up your existing Docker directory (/var/lib/docker)"
c mv /var/lib/docker /var/lib/docker.bak

log_task "Move Docker directory to new location (${DOCKER_IMAGE_DIR})"
c mkdir -p "${DOCKER_IMAGE_DIR}"
c mv /var/lib/docker "${DOCKER_IMAGE_DIR}"

log_task "Create a symlink to the new location"
c ln -s "${DOCKER_IMAGE_DIR}/docker" /var/lib/docker

log_task "Restart Docker daemon"
c systemctl start docker
